<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FaceID Photo Booth - Datanla</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- PAGE 1: WELCOME -->
    <div id="page-welcome" class="page active">
        <div class="welcome-container">
            <div class="logo-section">
                <div class="logo-icon">
                    <i class="fa-solid fa-camera-retro"></i>
                </div>
                <h1>FaceID</h1>
                <p class="subtitle">Datanla Photo Booth</p>
            </div>
            
            <div class="feature-box">
                <i class="fa-solid fa-face-smile"></i>
                <p>Quét khuôn mặt tự động</p>
            </div>
            
            <button class="btn-primary btn-large" id="btnStartScan">
                <i class="fa-solid fa-camera"></i>
                <span>Bắt đầu quét</span>
            </button>
            
            <div class="alternative-options">
                <button class="btn-link" id="btnUploadPhoto">
                    <i class="fa-solid fa-upload"></i>
                    Hoặc tải ảnh lên
                </button>
            </div>
        </div>
    </div>

    <!-- PAGE 2: CAMERA SCAN -->
    <div id="page-scan" class="page">
        <div class="scan-container">
            <button class="btn-back-scan" id="btnBackFromScan">
                <i class="fa-solid fa-xmark"></i>
            </button>
            
            <div class="camera-view">
                <video id="videoPreview" autoplay playsinline muted></video>
                <canvas id="captureCanvas" class="hidden"></canvas>
                
                <!-- Face Detection Overlay -->
                <div class="face-detection-overlay">
                    <div class="face-frame">
                        <div class="corner corner-tl"></div>
                        <div class="corner corner-tr"></div>
                        <div class="corner corner-bl"></div>
                        <div class="corner corner-br"></div>
                        <div class="scan-line"></div>
                    </div>
                    
                    <div class="grid-lines">
                        <div class="grid-line grid-h" style="top: 33%"></div>
                        <div class="grid-line grid-h" style="top: 66%"></div>
                        <div class="grid-line grid-v" style="left: 33%"></div>
                        <div class="grid-line grid-v" style="left: 66%"></div>
                    </div>
                </div>
                
                <!-- Progress Circle -->
                <div class="scan-progress hidden" id="scanProgress">
                    <svg class="progress-ring" width="120" height="120">
                        <circle class="progress-bg" cx="60" cy="60" r="52" />
                        <circle class="progress-bar" id="progressBar" cx="60" cy="60" r="52" />
                    </svg>
                    <div class="progress-info">
                        <div class="progress-percent" id="progressPercent">0%</div>
                        <div class="progress-label" id="progressLabel">Đang tìm...</div>
                    </div>
                </div>
                
                <!-- Guide text -->
                <div class="scan-guide" id="scanGuide">
                    <i class="fa-solid fa-user-circle"></i>
                    <p>Đưa mặt vào khung hình</p>
                </div>
                
                <!-- Camera error -->
                <div class="camera-error hidden" id="cameraError">
                    <i class="fa-solid fa-exclamation-triangle"></i>
                    <p>Không thể truy cập camera</p>
                    <button class="btn-secondary" id="btnGoUploadFromError">
                        <i class="fa-solid fa-upload"></i>
                        Tải ảnh lên
                    </button>
                </div>
            </div>
            
            <!-- Manual capture button (fallback) -->
            <button class="btn-capture hidden" id="btnManualCapture">
                <i class="fa-solid fa-camera"></i>
            </button>
        </div>
    </div>

    <!-- PAGE 3: UPLOAD (NEW) -->
    <div id="page-upload" class="page">
        <div class="upload-container">
            <button class="btn-back-scan" id="btnBackFromUpload">
                <i class="fa-solid fa-xmark"></i>
            </button>
            
            <div class="upload-content">
                <h2>Tải ảnh selfie lên</h2>
                <p class="upload-subtitle">Chụp hoặc chọn ảnh khuôn mặt của bạn</p>
                
                <div class="tips-box">
                    <h3><i class="fa-solid fa-lightbulb"></i> Mẹo chụp ảnh tốt:</h3>
                    <ul>
                        <li>✓ Đưa mặt vào giữa khung hình</li>
                        <li>✓ Chụp ở nơi sáng, tránh ngược sáng</li>
                        <li>✓ Tháo kính/mũ nếu có thể</li>
                        <li>✓ Chụp cận mặt (không quá xa)</li>
                    </ul>
                </div>
                
                <div class="upload-zone" id="uploadZone">
                    <input type="file" id="fileInput" accept="image/*" class="hidden">
                    <button class="btn-upload" id="btnSelectFile">
                        <i class="fa-solid fa-cloud-arrow-up"></i>
                        <span>Chọn ảnh từ thiết bị</span>
                    </button>
                    <div class="upload-preview hidden" id="uploadPreview">
                        <img id="uploadPreviewImage" alt="Preview">
                    </div>
                </div>
                
                <button class="btn-primary btn-large hidden" id="btnUploadAndScan">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <span>Quét ảnh này</span>
                </button>
            </div>
        </div>
    </div>

    <!-- PAGE 4: RESULTS -->
    <div id="page-results" class="page">
        <div class="results-container">
            <header class="results-header">
                <button class="btn-back" id="btnBackFromResults">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
                <div class="header-info">
                    <h2>Ảnh của bạn</h2>
                    <p id="photoCount">0 ảnh</p>
                </div>
            </header>
            
            <div class="photos-grid" id="photosGrid">
                <!-- Photos will be inserted here -->
            </div>
            
            <!-- Action bar -->
            <div class="action-bar hidden" id="actionBar">
                <div class="action-info">
                    <div class="selected-count" id="selectedCount">0 ảnh đã chọn</div>
                    <div class="pickup-note">
                        <i class="fa-solid fa-ticket"></i>
                        1 mã cho toàn bộ lô
                    </div>
                </div>
                <div class="action-buttons">
                    <button class="btn-action btn-clear" id="btnClear">
                        <i class="fa-solid fa-times"></i>
                    </button>
                    <button class="btn-action btn-print" id="btnPrint">
                        <i class="fa-solid fa-print"></i>
                        <span>In ảnh</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PAGE 5: CONFIRMATION -->
    <div id="page-confirmation" class="page">
        <div class="confirmation-container">
            <div class="success-animation">
                <div class="success-circle">
                    <i class="fa-solid fa-check"></i>
                </div>
            </div>
            
            <h2 class="success-title">Successful!</h2>
            <p class="success-subtitle">ID Confirmed. You may Enter.</p>
            
            <div class="user-card">
                <div class="user-avatar">
                    <i class="fa-solid fa-user"></i>
                </div>
                <div class="user-name">Khách hàng</div>
            </div>
            
            <div class="pickup-code-card">
                <div class="code-label">Mã nhận ảnh</div>
                <div class="pickup-code" id="pickupCodeDisplay">P-A12</div>
                <button class="btn-copy-code" id="btnCopyCode">
                    <i class="fa-solid fa-copy"></i>
                    Sao chép
                </button>
            </div>
            
            <div class="order-info">
                <div class="info-row">
                    <span>Số ảnh:</span>
                    <strong id="totalPhotos">0</strong>
                </div>
                <div class="info-row">
                    <span>Giờ vào:</span>
                    <strong id="entryTime">--:--</strong>
                </div>
                <div class="info-row">
                    <span>Tổng tiền:</span>
                    <strong id="totalAmount">0đ</strong>
                </div>
            </div>
            
            <div class="confirmation-actions">
                <button class="btn-primary btn-large" id="btnDone">
                    <i class="fa-solid fa-house"></i>
                    Hoàn tất
                </button>
                <button class="btn-secondary" id="btnScanMore">
                    <i class="fa-solid fa-camera"></i>
                    Quét thêm
                </button>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal hidden" id="loadingModal">
        <div class="modal-content">
            <div class="spinner"></div>
            <p id="loadingText">Đang xử lý...</p>
        </div>
    </div>

    <div class="modal hidden" id="errorModal">
        <div class="modal-content">
            <i class="fa-solid fa-triangle-exclamation"></i>
            <h3 id="errorTitle">Lỗi</h3>
            <p id="errorMessage">Đã có lỗi xảy ra</p>
            <div class="modal-actions">
                <button class="btn-primary" id="btnRetry">Thử lại</button>
                <button class="btn-secondary" id="btnCancelError">Hủy</button>
            </div>
        </div>
    </div>

    <!-- Lightbox -->
    <div class="lightbox hidden" id="lightbox">
        <button class="lightbox-close" id="btnCloseLightbox">
            <i class="fa-solid fa-xmark"></i>
        </button>
        <img id="lightboxImage" alt="Photo preview">
    </div>

    <!-- Toast container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- POS/Fullscreen controls -->
    <div class="floating-controls">
        <button class="btn-float" id="btnTogglePOS" title="POS Mode">
            <i class="fa-solid fa-tablet-screen-button"></i>
        </button>
        <button class="btn-float" id="btnFullscreen" title="Fullscreen">
            <i class="fa-solid fa-expand"></i>
        </button>
    </div>

    <script src="js/app.js"></script>
</body>
</html>